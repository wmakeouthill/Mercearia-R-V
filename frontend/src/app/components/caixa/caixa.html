<div class="caixa-container">
  <div class="top-bar">
    <div class="form-mov">
      <h3>Nova Movimenta√ß√£o</h3>
      <label>
        Tipo
        <select [(ngModel)]="tipo">
          <option value="entrada">Entrada</option>
          <option value="retirada">Retirada</option>
        </select>
      </label>
      <label>
        Valor
        <input type="number" [(ngModel)]="valor" min="0" step="0.01" />
      </label>
      <label class="flex-1">
        Descri√ß√£o
        <input type="text" [(ngModel)]="descricao" placeholder="Opcional" />
      </label>
      <div class="acoes-form">
        <button class="btn-primary" (click)="registrar()" [disabled]="loading">Registrar</button>
        <button class="btn-secondary" (click)="exportarCsv()">Exportar CSV</button>
        <button class="btn-ghost btn-registro" (click)="router.navigate(['/caixa/sessoes'])">Registro de Sess√µes</button>
        <button class="btn-voltar btn-voltar-compact" (click)="voltarAoDashboard()">‚Üê&nbsp;Voltar ao Dashboard</button>
      </div>
    </div>
  </div>

  <div class="top-bar filtros-secundarios filtros-combinados">
    <div class="filtros grupo-modo">
      <label>
        Modo
        <select class="compact select-modo" [(ngModel)]="filtroModo" (change)="onChangeModo()">
          <option value="tudo">Tudo</option>
          <option value="dia">Dia</option>
          <option value="mes">M√™s</option>
        </select>
      </label>
      <label>
        Data
        <input class="compact input-data" type="date" [(ngModel)]="dataSelecionada" (change)="onChangeData()" [disabled]="filtroModo!=='dia'" />
      </label>
      <label class="label-mes-compacto" title="Selecionar m√™s">
        M√™s
        <input class="month-compact compact" type="month" [(ngModel)]="mesSelecionado" (change)="onChangeMes()" [disabled]="filtroModo!=='mes'" />
        <span class="mes-compacto">{{ formatMesCompacto(mesSelecionado) }}</span>
      </label>
    </div>
    <div class="spacer"></div>
    <div class="filtros grupo-filtro">
      <label>
        Tipo
        <select class="compact" [(ngModel)]="filtroTipo" (change)="aplicarFiltrosMovs()">
          <option value="">Todos</option>
          <option value="entrada">Entrada</option>
          <option value="retirada">Retirada</option>
          <option value="venda">Venda</option>
        </select>
      </label>
      <label class="min-width">
        M√©todo
        <select class="compact" [(ngModel)]="filtroMetodo" (change)="aplicarFiltrosMovs()">
          <option value="">Todos</option>
          <option value="dinheiro">Dinheiro</option>
          <option value="cartao_credito">Cart√£o Cr√©dito</option>
          <option value="cartao_debito">Cart√£o D√©bito</option>
          <option value="pix">PIX</option>
        </select>
      </label>
      <label class="min-width">
        In√≠cio
        <input class="compact" type="time" [(ngModel)]="filtroHoraInicio" (change)="aplicarFiltrosMovs()" />
      </label>
      <label class="min-width">
        Fim
        <input class="compact" type="time" [(ngModel)]="filtroHoraFim" (change)="aplicarFiltrosMovs()" />
      </label>
      <label class="min-width">
        Exibir
        <select class="compact" [(ngModel)]="pageSize" (change)="setPageSize(pageSize)">
          <option [ngValue]="20">20</option>
          <option [ngValue]="50">50</option>
          <option [ngValue]="100">100</option>
        </select>
      </label>
      <button class="action-btn config-btn" (click)="aplicarFiltrosMovs()">Filtrar</button>
      <button class="action-btn close-btn" (click)="limparFiltrosMovs()">Limpar</button>
    </div>
  </div>

   @if (resumoVendasDia) {<div class="resumo">
    <div class="card">
      <div class="titulo">Receita de Vendas (dia)</div>
      <div class="valor positivo">
        R$ {{ totalVendasHoje | number:'1.2-2' }}
      </div>
    </div>
    <div class="card">
      <div class="titulo">Saldo de Movimenta√ß√µes (dia)</div>
      <div class="valor" [class.positivo]="saldoMovimentacoesHoje >= 0" [class.negativo]="saldoMovimentacoesHoje < 0">
        R$ {{ saldoMovimentacoesHoje | number:'1.2-2' }}
      </div>
    </div>
    <div class="card">
      <div class="titulo">Total no Caixa (vendas + movs)</div>
      <div class="valor" [class.positivo]="totalNoCaixaHoje >= 0" [class.negativo]="totalNoCaixaHoje < 0">
        R$ {{ totalNoCaixaHoje | number:'1.2-2' }}
      </div>
    </div>
     <div class="card">
       <div class="titulo">Somat√≥rios do Per√≠odo</div>
       <div class="valor positivo">Entradas: R$ {{ sumEntradas | number:'1.2-2' }}</div>
       <div class="valor negativo">Retiradas: R$ {{ sumRetiradas | number:'1.2-2' }}</div>
       <div class="valor">Vendas: R$ {{ sumVendas | number:'1.2-2' }}</div>
     </div>
  </div>}

  <div class="mensagens">
    @if (error) {<div class="erro" (click)="error = ''" (keydown.enter)="error = ''" (keydown.space)="error = ''">{{ error }}</div>}
    @if (success) {<div class="sucesso" (click)="success = ''" (keydown.enter)="success = ''" (keydown.space)="success = ''">{{ success }}</div>}
  </div>

  <!-- Modal de confirma√ß√£o customizado (reaproveitado para exclus√£o de movimenta√ß√£o) -->
  <div *ngIf="showConfirmModal" class="confirm-overlay">
    <div class="confirm-dialog">
      <h3>{{ confirmTitle }}</h3>
      <p>{{ confirmMessage }}</p>
      <div class="confirm-actions">
        <button class="btn-cancel" (click)="confirmModalCancel()">Cancelar</button>
        <button class="btn-confirm" (click)="confirmModalConfirm()">Confirmar</button>
      </div>
    </div>
  </div>

  <div class="lista">
    <h3>Movimenta√ß√µes do dia</h3>
     @if (!movimentacoes || movimentacoes.length === 0) {<div class="vazia">Sem movimenta√ß√µes</div>}
     @if (movimentacoes && movimentacoes.length > 0) {
      <div class="tabela-wrapper">
        <table class="movs-table">
          <colgroup>
            <col style="width:120px" />
            <col style="width:260px" />
            <col style="width:120px" />
            <col />
            <col style="width:160px" />
            <col style="width:160px" />
            <col style="width:200px" />
            <col style="width:80px" />
            <col style="width:80px" />
          </colgroup>
          <thead>
            <tr>
              <th class="center">Tipo</th>
              <th>Produto</th>
              <th class="center">Valor</th>
              <th>Descri√ß√£o</th>
              <th class="center">M√©todo</th>
              <th class="center">Usu√°rio</th>
              <th class="center">Data/Hora</th>
              <th class="center">Id</th>
              <th class="center">A√ß√£o</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let m of movimentacoes">
              <td class="center">
                <span class="badge" [ngClass]="{entrada: m.tipo === 'entrada', retirada: m.tipo === 'retirada', venda: m.tipo === 'venda'}">
                  <span *ngIf="m.tipo === 'entrada'" class="icon">‚ûï</span>
                  <span *ngIf="m.tipo === 'retirada'" class="icon">‚ûñ</span>
                  <span *ngIf="m.tipo === 'venda'" class="icon">üõí</span>
                  <span class="label">{{ m.tipo }}</span>
                </span>
              </td>
              <td class="produto">{{ m.produto_nome || '-' }}</td>
              <td class="center">R$ {{ m.valor | number:'1.2-2' }}</td>
              <td class="descricao">{{ m.descricao || '-' }}</td>
              <td class="center metodo">
                <div class="metodo-multi">
                  <span *ngFor="let b of getMetodoBadges(m)" class="metodo-badge">{{ b }}</span>
                </div>
              </td>
              <td class="center">{{ m.usuario || '-' }}</td>
              <td class="center">{{ m.data_movimento | date:'dd/MM/yyyy HH:mm' }}</td>
              <td class="center">{{ m.caixa_status_id || (m.caixa_status ? m.caixa_status.id : '-') }}</td>
              <td class="center">
                <button *ngIf="m.tipo !== 'venda'" type="button" (click)="$event.stopPropagation(); onMovBtnClickLog(m.id); onDeleteMovClick($event, m.id)" class="btn-excluir" [class.disabled]="!authService.isAdmin()" [attr.title]="!authService.isAdmin() ? 'Somente administradores podem excluir movimenta√ß√µes' : 'Excluir movimenta√ß√£o'">üóëÔ∏è</button>
                <div *ngIf="m.tipo === 'venda'" style="color:var(--medium-gray); font-size:0.9rem">‚Äî</div>
              </td>
            </tr>
          </tbody>
        </table>





























      \n+







































         <div class="paginacao">
           <div class="pagination-left">
             <button class="btn-page btn-ghost" (click)="goToFirstPage()" [disabled]="page<=1" title="Primeira">¬´</button>
             <button class="btn-page btn-ghost" (click)="goBy(-10)" [disabled]="page<=1" title="-10">¬´10</button>
             <button class="btn-page btn-ghost" (click)="goBy(-5)" [disabled]="page<=1" title="-5">¬´5</button>
             <button class="btn-page btn-ghost" (click)="prevPage()" [disabled]="page<=1" title="Anterior">‚Äπ</button>
           </div>
           <div class="pagination-center">
             @for (p of paginationItems; track $index) {
               @if (p === '‚Ä¶') {<span class="ellipsis">‚Ä¶</span>} @else {<button class="btn-page" [class.active]="p === page" (click)="onClickPage(p)">{{ p }}</button>}
             }
           </div>
           <div class="pagination-right">
             <button class="btn-page btn-ghost" (click)="nextPage()" [disabled]="page>=totalPages" title="Pr√≥xima">‚Ä∫</button>
             <button class="btn-page btn-ghost" (click)="goBy(5)" [disabled]="page>=totalPages" title="+5">5¬ª</button>
             <button class="btn-page btn-ghost" (click)="goBy(10)" [disabled]="page>=totalPages" title="+10">10¬ª</button>
             <button class="btn-page btn-ghost" (click)="goToLastPage()" [disabled]="page>=totalPages" title="√öltima">¬ª</button>
           </div>
           <div class="pagination-jump">
             <label>
               Ir para
               <input type="number" min="1" [max]="totalPages" [(ngModel)]="jumpPage" (keyup.enter)="onJumpToPage()" />
             </label>
             <button class="btn-go" (click)="onJumpToPage()">Ir</button>
           </div>
         </div>
      </div>
    }
  </div>
</div>

<!-- modais removidos (opera√ß√µes via dashboard/ponto-venda) -->

