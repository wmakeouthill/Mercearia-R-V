<div class="exchange-list">
  <div class="filters">
    <input type="text" placeholder="Pesquisar (id, cliente, item)" [(ngModel)]="q" (input)="onQueryInput(q)" class="input-filtro-busca">
    <select [(ngModel)]="operatorFilter" class="select-filtro-operator" (change)="loadPage(0)">
      <option value="">Todos Operadores</option>
      <option *ngFor="let op of operators" [value]="op.username">{{ op.username }}</option>
    </select>
    <input type="date" [(ngModel)]="from">
    <input type="time" [(ngModel)]="fromTime" placeholder="HH:mm">
    <input type="date" [(ngModel)]="to">
    <input type="time" [(ngModel)]="toTime" placeholder="HH:mm">
    <label>Linhas:
      <select [(ngModel)]="size" (change)="loadPage(0)">
        <option [ngValue]="5">5</option>
        <option [ngValue]="10">10</option>
        <option [ngValue]="20">20</option>
      </select>
    </label>
    <button class="btn-limpar-filtro" (click)="q=''; operatorFilter=''; from=''; to=''; fromTime=''; toTime=''; loadPage(0)">Limpar</button>
    <button class="btn-filtrar" (click)="loadPage(0)">ğŸ” Buscar</button>
  </div>

  <div *ngIf="loading">Carregando...</div>
  <table *ngIf="!loading">
    <thead>
      <tr>
        <th>ID</th>
        <th>Produtos</th>
        <th>Itens</th>
        <th>Total Bruto</th>
        <th>Total LÃ­quido</th>
        <th>Operador</th>
        <th>Cliente</th>
        <th>Data</th>
        <th>Status</th>
        <th>AÃ§Ãµes</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let it of items" [class.full-returned-row]="it.full_returned" [class.partial-returned-row]="it.partial_returned">
        <td>{{ it.id }}</td>
        <td class="produtos-preview" [title]="it.products_preview || ''">{{ it.products_preview || '' }}</td>
        <td>{{ it.itens_count }}</td>
        <td class="tabela-total">{{ it.total_preview ? (it.total_preview | currencyBR) : '' }}</td>
        <td class="tabela-total" [class.net-diff]="it.net_total !== it.total_preview">{{ (it.net_total ?? it.total_preview) | currencyBR }}</td>
        <td>{{ it.operator || '-' }}</td>
        <td>{{ it.customer_name || '-' }}</td>
        <td>{{ formatDate(it.data_venda) }}</td>
        <td class="status-col">
          <span *ngIf="it.full_returned" class="badge badge-full">Devolvida</span>
          <span *ngIf="!it.full_returned && it.partial_returned" class="badge badge-partial">Parcial</span>
        </td>
        <td class="acoes-col"><button class="btn-detalhar" (click)="openSaleDetail(it)">Detalhar</button></td>
      </tr>
    </tbody>
  </table>

  <div class="paginacao">
    <div class="pagination-left">
      <button class="btn-page btn-ghost" (click)="goToFirstPage()" [disabled]="page<=0">Â«</button>
      <button class="btn-page btn-ghost" (click)="goBy(-10)" [disabled]="page<=0">Â«10</button>
      <button class="btn-page btn-ghost" (click)="goBy(-5)" [disabled]="page<=0">Â«5</button>
      <button class="btn-page btn-ghost" (click)="prevPage()" [disabled]="page<=0">â€¹</button>
    </div>
    <div class="pagination-center">
      <ng-container *ngFor="let p of paginationItems">
        <span *ngIf="p === 'â€¦'" class="ellipsis">â€¦</span>
        <button *ngIf="p !== 'â€¦'" class="btn-page" [class.active]="p === (page+1)" (click)="onClickPage(p)">{{ p }}</button>
      </ng-container>
    </div>
    <div class="pagination-right">
      <button class="btn-page btn-ghost" (click)="nextPage()" [disabled]="(page+1)*size >= total">â€º</button>
      <button class="btn-page btn-ghost" (click)="goBy(5)" [disabled]="(page+1)*size >= total">5Â»</button>
      <button class="btn-page btn-ghost" (click)="goToLastPage()" [disabled]="(page+1)*size >= total">Â»</button>
    </div>
    <div class="pagination-jump">
      <label>
        Ir para
        <input type="number" min="1" [max]="totalPages" [(ngModel)]="jumpPage" (keyup.enter)="loadPage(jumpPage-1)" />
      </label>
      <button class="btn-go" (click)="loadPage(jumpPage-1)">Ir</button>
    </div>
  </div>



  <app-exchange-return-detail-modal *ngIf="selectedSale" [saleSummary]="selectedSale" (close)="closeDetail()"></app-exchange-return-detail-modal>
</div>


