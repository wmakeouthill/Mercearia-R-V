<div class="form-produto-container">
    <div class="form-produto-header">
        <h1>{{ isEditing ? 'Editar Produto' : 'Novo Produto' }}</h1>
        <button (click)="cancelar()" class="btn-voltar">‚Üê Voltar ao Dashboard</button>
    </div>

    @if (error) {<div class="error-message">
        {{ error }}
    </div>}

    @if (sucesso) {<div class="success-message">
        {{ sucesso }}
    </div>}

    @if (loading) {<div class="loading">
        {{ isEditing ? 'Carregando produto...' : 'Salvando produto...' }}
    </div>}

    @if (!loading) {<form (ngSubmit)="onSubmit()" class="form-produto">
        <!-- Se√ß√£o de imagem do produto -->
            <div class="form-group image-section">
            <label for="imagem">Imagem do Produto</label>
            <div class="image-upload-container">
                <!-- Sempre mostrar preview da imagem (com fallback para padr√£o) -->
                <div class="image-preview">
                    <img [src]="imagemPreview || getImageUrl(produto.imagem)" alt="Preview do produto"
                        class="preview-image" (error)="onImageError($event)">
                    @if (imagemPreview || produto.imagem) {<button type="button" (click)="removerImagem()"
                           class="btn-remove-image" title="Remover imagem">
                        ‚ùå
                    </button>}
                </div>

                <!-- Bot√µes de a√ß√£o -->
                <div class="image-actions">
                    <input type="file" id="imagem" (change)="onImageSelected($event)" accept="image/*"
                           class="file-input">
                    <label for="imagem" class="file-label">
                        {{ imagemPreview || produto.imagem ? 'üîÑ Alterar Imagem' : 'üì∑ Escolher Imagem' }}
                    </label>
                    <p class="image-info">PNG, JPG, GIF at√© 5MB</p>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="nome">Nome do Produto *</label>
            <input type="text" id="nome" [(ngModel)]="produto.nome" name="nome" placeholder="Digite o nome do produto"
                class="form-control" required>
        </div>

        <div class="form-group">
            <label for="codigo_barras">C√≥digo de Barras</label>
            <div class="codigo-barras-group">
                <input type="text" id="codigo_barras" [(ngModel)]="produto.codigo_barras" name="codigo_barras"
                    placeholder="Digite o c√≥digo de barras" class="form-control">
                <button type="button" (click)="gerarCodigoBarras()" class="btn-gerar-codigo">
                    üî¢ Gerar
                </button>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="preco_venda">Pre√ßo de Venda (R$) *</label>
                <input type="number" id="preco_venda" [(ngModel)]="produto.preco_venda" name="preco_venda"
                    placeholder="0.00" class="form-control" step="0.01" min="0" required>
            </div>

            <div class="form-group">
                <label for="quantidade_estoque">Quantidade em Estoque *</label>
                <input type="number" id="quantidade_estoque" [(ngModel)]="produto.quantidade_estoque"
                    name="quantidade_estoque" placeholder="0" class="form-control" min="0" required>
            </div>
        </div>

        <div class="form-actions">
            <button type="button" (click)="limparFormulario()" class="btn-limpar">
                üóëÔ∏è Limpar
            </button>
            <button type="button" (click)="cancelar()" class="btn-cancelar">
                ‚ùå Cancelar
            </button>
            <button type="submit" [disabled]="loading" class="btn-salvar">
                @if (loading) {<span>üíæ Salvando...</span>} @else {<span>{{ isEditing ? '‚úèÔ∏è Atualizar' : '‚ûï Criar' }}</span>}
            </button>
        </div>
    </form>}

    <div class="form-info">
        <h3>Informa√ß√µes</h3>
        <ul>
            <li>Campos marcados com * s√£o obrigat√≥rios</li>
            <li>O c√≥digo de barras pode ser gerado automaticamente</li>
            <li>Pre√ßo de venda deve ser maior que zero</li>
            <li>Quantidade em estoque n√£o pode ser negativa</li>
        </ul>
    </div>
</div>
