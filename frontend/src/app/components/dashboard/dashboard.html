<div class="dashboard-container">
    <div class="dashboard-header">
        <div class="header-content">
            <div class="welcome-section">
                <h1>Painel de Controle</h1>
                <p class="welcome-text">Gerencie sua mercearia de forma eficiente</p>
            </div>
            <div class="user-info">
                <div class="user-details">
                    <span class="user-name">{{ currentUser?.username }}</span>
                    <span class="user-role">{{ currentUser?.role === 'admin' ? 'Administrador' : 'Operador' }}</span>
                    <div class="caixa-status">
                        <span class="status-indicator" [class.aberto]="statusCaixa?.aberto"
                            [class.fechado]="!statusCaixa?.aberto"></span>
                        <span class="status-text">{{ statusCaixa?.aberto ? 'Caixa Aberto' : 'Caixa Fechado' }}</span>
                    </div>
                </div>
                <button (click)="logout()" class="logout-button">
                    <span class="logout-icon">üö™</span>
                    Sair
                </button>
            </div>
        </div>
    </div>

    <main class="dashboard-main">
        <!-- Mensagens -->
        @if (error) {
            <div class="message error-message" (click)="clearMessages()" (keydown.enter)="clearMessages()" (keydown.space)="clearMessages()">
                <span class="message-icon">‚ö†Ô∏è</span>
                <span>{{ error }}</span>
                <button class="close-btn">√ó</button>
            </div>
        }

        @if (success) {
            <div class="message success-message" (click)="clearMessages()" (keydown.enter)="clearMessages()" (keydown.space)="clearMessages()">
                <span class="message-icon">‚úÖ</span>
                <span>{{ success }}</span>
                <button class="close-btn">√ó</button>
            </div>
        }

        <div class="navigation-grid">
            @if (isAdmin) {<div class="nav-card admin-card" (click)="navigateTo('/produtos')" (keydown.enter)="navigateTo('/produtos')" (keydown.space)="navigateTo('/produtos')">
                <div class="card-header">
                    <div class="nav-icon">üì¶</div>
                    <h3>Produtos</h3>
                </div>
                <div class="card-body">
                    <p>Gerenciar produtos e estoque</p>
                    <div class="card-accent admin-accent"></div>
                </div>
            </div>}

            @if (isAdmin) {<div class="nav-card admin-card" (click)="navigateTo('/caixa')" (keydown.enter)="navigateTo('/caixa')" (keydown.space)="navigateTo('/caixa')">
                <div class="card-header">
                    <div class="nav-icon">üßæ</div>
                    <h3>Caixa</h3>
                </div>
                <div class="card-body">
                    <p>Movimenta√ß√µes e saldo do dia</p>
                    <div class="card-accent admin-accent"></div>
                </div>
            </div>}

                        <div class="nav-card sales-card" [class.blocked]="!isAdmin && statusCaixa && !statusCaixa.aberto" (click)="handlePontoVendaClick()" (keydown.enter)="handlePontoVendaClick()" (keydown.space)="handlePontoVendaClick()">
                <div class="card-header">
                    <div class="nav-icon">üí∞</div>
                    <h3>Ponto de Venda</h3>
                </div>
                <div class="card-body">
                    <p>Realizar vendas</p>
                    <div class="card-accent"></div>
                </div>

                <!-- Overlay de bloqueio quando caixa fechado -->
                @if (!isAdmin && statusCaixa && !statusCaixa.aberto) {
                    <div class="caixa-blocked-overlay">
                        <div class="overlay-content">
                            <div class="lock-icon">üîí</div>
                            <span class="blocked-text">Caixa Fechado</span>
                        </div>
                    </div>
                }
            </div>

            <div class="nav-card reports-card" (click)="navigateTo('/relatorios')" (keydown.enter)="navigateTo('/relatorios')" (keydown.space)="navigateTo('/relatorios')">
                <div class="card-header">
                    <div class="nav-icon">üìä</div>
                    <h3>Relat√≥rios</h3>
                </div>
                <div class="card-body">
                    <p>Visualizar relat√≥rios de vendas</p>
                    <div class="card-accent"></div>
                </div>
            </div>

            @if (isAdmin) {<div class="nav-card admin-card" (click)="navigateTo('/produtos/estoque')" (keydown.enter)="navigateTo('/produtos/estoque')" (keydown.space)="navigateTo('/produtos/estoque')">
                <div class="card-header">
                    <div class="nav-icon">üìã</div>
                    <h3>Gerenciar Estoque</h3>
                </div>
                <div class="card-body">
                    <p>Ajustar quantidades</p>
                    <div class="card-accent admin-accent"></div>
                </div>
            </div>}

            @if (isAdmin) {<div class="nav-card admin-card" (click)="navigateTo('/vendas/historico')" (keydown.enter)="navigateTo('/vendas/historico')" (keydown.space)="navigateTo('/vendas/historico')">
                <div class="card-header">
                    <div class="nav-icon">üìà</div>
                    <h3>Hist√≥rico de Vendas</h3>
                </div>
                <div class="card-body">
                    <p>Ver todas as vendas</p>
                    <div class="card-accent admin-accent"></div>
                </div>
            </div>}



            @if (isAdmin) {<div class="nav-card admin-card" (click)="navigateTo('/logs')" (keydown.enter)="navigateTo('/logs')" (keydown.space)="navigateTo('/logs')">
                <div class="card-header">
                    <div class="nav-icon">üìã</div>
                    <h3>Logs do Sistema</h3>
                </div>
                <div class="card-body">
                    <p>Monitorar atividades</p>
                    <div class="card-accent admin-accent"></div>
                </div>
            </div>}

            @if (isAdmin) {<div class="nav-card admin-card" (click)="navigateTo('/administracao')" (keydown.enter)="navigateTo('/administracao')" (keydown.space)="navigateTo('/administracao')">
                <div class="card-header">
                    <div class="nav-icon">‚öôÔ∏è</div>
                    <h3>Administra√ß√£o</h3>
                </div>
                <div class="card-body">
                    <p>Gerenciar usu√°rios e sistema</p>
                    <div class="card-accent admin-accent"></div>
                </div>
            </div>}
        </div>

        <div class="dashboard-info">
            <div class="info-card">
                <div class="card-header">
                    <h3>üìã Informa√ß√µes do Sistema</h3>
                </div>
                <div class="card-body">
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Usu√°rio:</span>
                            <span class="info-value">{{ currentUser?.username }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Perfil:</span>
                            <span class="info-value">{{ currentUser?.role === 'admin' ? 'Administrador' : 'Operador'
                                }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Permiss√µes:</span>
                            <span class="info-value">{{ isAdmin ? 'Completas' : 'Limitadas' }}</span>
                        </div>
                        @if (podeControlarCaixa) {<div class="info-item caixa-control">
                            <span class="info-label">Status do Caixa:</span>
                            <span class="info-value" [class.caixa-aberto]="statusCaixa?.aberto"
                                [class.caixa-fechado]="!statusCaixa?.aberto">
                                {{ statusCaixa?.aberto ? 'Aberto' : 'Fechado' }}
                                <span class="status-dot" [class.aberto]="statusCaixa?.aberto"
                                    [class.fechado]="!statusCaixa?.aberto"></span>
                            </span>
                            <div class="caixa-actions">
                                <button (click)="abrirCaixa()" class="action-btn open-btn"
                                    [disabled]="loading || statusCaixa?.aberto" title="Abrir Caixa">
                                    @if (loading) {<span>‚è≥</span>} @else {<span>üìÇ</span>}
                                    Abrir Caixa
                                </button>
                                <button (click)="fecharCaixa()" class="action-btn close-btn"
                                    [disabled]="loading || !statusCaixa?.aberto" title="Fechar Caixa">
                                    @if (loading) {<span>‚è≥</span>} @else {<span>üîí</span>}
                                    Fechar Caixa
                                </button>
                                @if (isAdmin) {<button (click)="toggleHorariosConfig()" class="action-btn config-btn"
                                    title="Configurar Hor√°rios">
                                    ‚öôÔ∏è Hor√°rios
                                </button>}
                            </div>
                        </div>}
                    </div>
                </div>
            </div>

            <!-- Configura√ß√£o de Hor√°rios (apenas admin) -->
            @if (showHorariosConfig && isAdmin) {<div class="info-card config-card">
                <div class="card-header">
                    <h3>‚è∞ Configura√ß√£o de Hor√°rios Autom√°ticos</h3>
                    <button (click)="toggleHorariosConfig()" class="close-config-btn">√ó</button>
                </div>
                <div class="card-body">
                    <div class="horarios-form">
                        <div class="form-group">
                            <label for="horarioAbertura">Hor√°rio de Abertura Obrigat√≥rio:</label>
                            <input type="time" id="horarioAbertura" [(ngModel)]="horarioAbertura" class="time-input">
                        </div>
                        <div class="form-group">
                            <label for="horarioFechamento">Hor√°rio de Fechamento Obrigat√≥rio:</label>
                            <input type="time" id="horarioFechamento" [(ngModel)]="horarioFechamento"
                                class="time-input">
                        </div>
                        <div class="form-actions">
                            <button (click)="salvarHorarios()" class="save-btn" [disabled]="loading">
                                @if (loading) {<span>‚è≥</span>} @else {<span>üíæ</span>}
                                Salvar Hor√°rios
                            </button>
                        </div>
                        <p class="info-text">
                            <strong>Nota:</strong> Quando configurados, o caixa ser√° aberto/fechado automaticamente nos
                            hor√°rios definidos.
                        </p>
                    </div>
                </div>
            </div>}
        </div>
    </main>
</div>
